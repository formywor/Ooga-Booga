<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ScriptNova Lookup</title>
  <style>
    :root{
      --bg:#070A12; --card:#0C1222; --muted:#9FB0D0; --text:#EAF0FF;
      --accent:#6AA7FF; --accent2:#7CFFB2; --danger:#FF6A7A;
      --border:rgba(255,255,255,.08);
      --shadow: 0 14px 50px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(900px 500px at 20% 0%, rgba(106,167,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 80% 20%, rgba(124,255,178,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    header{
      padding:28px 18px 10px;
      max-width:1100px;
      margin:0 auto;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
    }
    .brand{
      display:flex; flex-direction:column; gap:6px;
    }
    .brand h1{
      margin:0; font-size:22px; letter-spacing:.4px;
    }
    .brand p{ margin:0; color:var(--muted); font-size:13px; line-height:1.35 }
    .pill{
      border:1px solid var(--border);
      padding:8px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      background: rgba(255,255,255,.03);
      white-space:nowrap;
    }

    main{ max-width:1100px; margin:0 auto; padding:14px 18px 28px; }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
    }
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .card .hd h2{ margin:0; font-size:14px; letter-spacing:.35px; color:rgba(234,240,255,.9); }
    .card .bd{ padding:14px; }

    .searchRow{
      display:flex;
      gap:10px;
      align-items:center;
    }
    input[type="text"]{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.35);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input[type="text"]::placeholder{ color:rgba(159,176,208,.75); }
    button{
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(106,167,255,.12);
      color:var(--text);
      font-weight:600;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease;
      white-space:nowrap;
    }
    button:hover{ background: rgba(106,167,255,.18); }
    button:active{ transform: translateY(1px); }

    .results{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:12px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      cursor:pointer;
      transition: background .2s ease, transform .08s ease, border-color .2s ease;
    }
    .row:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(106,167,255,.35);
    }
    .row:active{ transform: translateY(1px); }
    .row.active{ border-color: rgba(124,255,178,.45); background: rgba(124,255,178,.06); }
    .nameLine{ display:flex; flex-direction:column; gap:3px; }
    .nameLine .nm{ font-weight:800; letter-spacing:.3px; }
    .nameLine .sub{ color:var(--muted); font-size:12px; }
    .tag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--muted);
      background: rgba(255,255,255,.03);
    }
    .tag.locked{ color: rgba(255,106,122,.95); border-color: rgba(255,106,122,.35); background: rgba(255,106,122,.08); }
    .empty{
      color:var(--muted);
      font-size:13px;
      padding:14px;
      border:1px dashed rgba(255,255,255,.12);
      border-radius:14px;
      background: rgba(0,0,0,.2);
      margin-top:12px;
    }

    /* Right panel */
    .panel{
      min-height:350px;
      position:relative;
    }
    .panel .placeholder{
      color:var(--muted);
      font-size:13px;
      line-height:1.55;
    }
    .kv{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    .kv .item{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      background: rgba(0,0,0,.25);
    }
    .kv .k{ color:rgba(159,176,208,.9); font-size:12px; }
    .kv .v{ margin-top:4px; font-weight:700; letter-spacing:.15px; }
    .warn{
      border-color: rgba(255,106,122,.35);
      background: rgba(255,106,122,.08);
    }
    .unlock-btn{
      margin-top:12px;
      width:100%;
      padding:10px;
      background: rgba(124,255,178,.12);
      border:1px solid rgba(124,255,178,.35);
      color: #7CFFB2;
      border-radius:12px;
      font-weight:600;
      cursor:pointer;
    }
    .unlock-btn:hover{ background: rgba(124,255,178,.22); }

    /* Modal overlay */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .overlay.show{ display:flex; }
    .modal{
      width:min(680px, 100%);
      border-radius:18px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(12,18,34,.96), rgba(8,12,24,.96));
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(8px);
      animation: pop .18s ease forwards;
    }
    @keyframes pop{ to{ transform: translateY(0); } }
    .modalHd{
      padding:14px;
      border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .modalHd .t{ font-weight:900; letter-spacing:.3px; }
    .x{
      border-radius:10px;
      padding:8px 10px;
      background: rgba(255,255,255,.04);
    }

    .modalBd{ padding:14px; }
    .loaderRow{
      display:flex; align-items:center; gap:12px;
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: rgba(0,0,0,.22);
    }
    .spinner{
      width:38px; height:38px;
      border-radius:50%;
      border: 3px solid rgba(255,255,255,.12);
      border-top-color: rgba(106,167,255,.95);
      animation: spin 1s linear infinite;
      flex:0 0 auto;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
    .log{
      margin-top:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      color: rgba(234,240,255,.9);
      line-height:1.55;
      white-space:pre-wrap;
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: rgba(0,0,0,.25);
      min-height:140px;
    }
    .smallNote{ color:var(--muted); font-size:12px; margin-top:10px; }

    /* Disclaimer banner */
    .disclaimer{
      position:fixed;
      top:0; left:0; right:0;
      background: rgba(255,106,122,.95);
      color:#fff;
      padding:12px 18px;
      font-size:13px;
      line-height:1.45;
      text-align:center;
      z-index:100;
      border-bottom:1px solid rgba(255,255,255,.2);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
    }
    .disclaimer a{ color:#fff; text-decoration:underline; }
    .disclaimer button{
      background: rgba(255,255,255,.2);
      border:none;
      color:#fff;
      padding:4px 12px;
      border-radius:999px;
      font-size:12px;
      cursor:pointer;
    }

    /* Server error note */
    .server-note{
      background: rgba(255,193,7,.12);
      border:1px solid rgba(255,193,7,.35);
      color:rgba(255,193,7,.95);
      padding:10px 14px;
      border-radius:12px;
      font-size:12.5px;
      margin-bottom:12px;
    }
  </style>
</head>
<body>
  <!-- Disclaimer banner -->
  <div class="disclaimer" id="disclaimer">
    <div>
      Before entering: We have full permission to use your data in any way, as you agreed to it by being on this site.<br>
      If you wish to remove your name, email <a href="mailto:gomegaassist@gmail.com">gomegaassist@gmail.com</a>.<br>
      We are still adding more users every day — please be patient if the person you're looking for isn't here yet.
    </div>
    <button onclick="dismissDisclaimer()">Got it</button>
  </div>

  <header>
    <div class="brand">
      <h1>ScriptNova Lookup</h1>
      <p>Search opted-in profiles. Click a result to run a lookup and view available fields.</p>
    </div>
    <div class="pill" id="urlPill">novalookup</div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <div class="hd">
          <h2>Search</h2>
          <span class="pill" id="countPill">13 profiles loaded</span>
        </div>
        <div class="bd">
          <div class="server-note">
            ERROR: Loading 135 other profiles failed due to server lag.<br>
            These are the only profiles that were not damaged. We're very sorry.
          </div>

          <div class="searchRow">
            <input id="q" type="text" placeholder="Search by first name, last name, or full name (e.g., Conner / Pangelinan / Emy Girgis)" autocomplete="off" />
            <button id="clearBtn" type="button">Clear</button>
          </div>

          <div id="results" class="results"></div>
          <div id="empty" class="empty" style="display:none;">No matches. Try fewer words.</div>
        </div>
      </section>

      <section class="card panel">
        <div class="hd">
          <h2>Profile</h2>
          <span class="pill" id="selectedPill">None selected</span>
        </div>
        <div class="bd" id="profilePanel">
          <div class="placeholder">
            Select a person on the left to view details here.
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Lookup modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Lookup">
    <div class="modal">
      <div class="modalHd">
        <div class="t" id="modalTitle">Looking up…</div>
        <button class="x" id="closeModal" type="button">Close</button>
      </div>
      <div class="modalBd">
        <div class="loaderRow">
          <div class="spinner"></div>
          <div>
            <div style="font-weight:900" id="phaseTitle">Initializing lookup</div>
            <div style="color:var(--muted); font-size:12px;" id="phaseSub">Preparing logs…</div>
          </div>
        </div>

        <div class="log" id="logBox">[system] starting…</div>
        <div class="smallNote" id="smallNote"></div>
      </div>
    </div>
  </div>

  <script>
    // Real opted-in data (static for now — move to backend later for true security)
    const PEOPLE = [
      {
        id: "snv-47f2a9e3",
        first: "Conner",
        last: "Pangelinan",
        locked: false,
        fields: {
          "School": "Pocahontas Middle School (PMS)",
          "Has a crush on": "Presley McCowin",
          "Gmail messages": "98 with Presley McCowin"
        }
      },
      {
        id: "snv-3b8c2d4e",
        first: "Emy",
        last: "Girgis",
        locked: false,
        fields: {
          "School": "Pocahontas Middle School (PMS)",
          "Has a crush on": "Fady Gaid",
          "Gmail messages": "151 with Ivy Lienemann",
          "Recent activity": "Discussed Varina HS issues, assemblies, field trips, friends like Lily"
        }
      },
      {
        id: "snv-9f1e7a3b",
        first: "Ivy",
        last: "Lienemann",
        locked: false,
        fields: {
          "School": "Varina High School",
          "Gmail messages": "151 with Emy Girgis",
          "Recent activity": "Talked about school fights, scholarships, chorus field trips, friends drama"
        }
      },
      {
        id: "snv-1a2b3c4d",
        first: "Liam",
        last: "Thompson",
        locked: false,
        fields: {
          "School": "Deep Run High School",
          "Has a crush on": "Olivia Garcia",
          "Gmail messages": "67 with Mia Chen"
        }
      },
      {
        id: "snv-5e6f7g8h",
        first: "Sophia",
        last: "Ramirez",
        locked: false,
        fields: {
          "School": "Godwin High School",
          "Has a crush on": "Noah Patel",
          "Gmail messages": "112 with Ava Singh"
        }
      },
      {
        id: "snv-9i0j1k2l",
        first: "Ethan",
        last: "Patel",
        locked: true,
        fields: {
          "School": "Henrico High School",
          "Has a crush on": "Isabella Kim",
          "Gmail messages": "34 with Lucas Rodriguez"
        }
      },
      {
        id: "snv-3m4n5o6p",
        first: "Ava",
        last: "Nguyen",
        locked: false,
        fields: {
          "School": "Tuckahoe Middle School",
          "Has a crush on": "James Wilson",
          "Gmail messages": "89 with Harper Lee"
        }
      },
      {
        id: "snv-7q8r9s0t",
        first: "Noah",
        last: "Kim",
        locked: false,
        fields: {
          "School": "Varina High School",
          "Has a crush on": "Charlotte Brown",
          "Gmail messages": "56 with Elijah Davis"
        }
      },
      {
        id: "snv-1u2v3w4x",
        first: "Mia",
        last: "Chen",
        locked: true,
        fields: {
          "School": "Pocahontas Middle School (PMS)",
          "Has a crush on": "Alexander Lopez",
          "Gmail messages": "145 with Amelia Martinez"
        }
      },
      {
        id: "snv-5y6z7a8b",
        first: "Lucas",
        last: "Rodriguez",
        locked: false,
        fields: {
          "School": "Deep Run High School",
          "Has a crush on": "Evelyn Taylor",
          "Gmail messages": "78 with Mason Anderson"
        }
      },
      {
        id: "snv-9c0d1e2f",
        first: "Isabella",
        last: "Garcia",
        locked: false,
        fields: {
          "School": "Godwin High School",
          "Has a crush on": "Logan Thomas",
          "Gmail messages": "203 with Harper White"
        }
      },
      {
        id: "snv-3g4h5i6j",
        first: "James",
        last: "Wilson",
        locked: false,
        fields: {
          "School": "Henrico High School",
          "Has a crush on": "Scarlett Moore",
          "Gmail messages": "41 with Jackson Clark"
        }
      },
      {
        id: "snv-8k9l0m1n",
        first: "ScriptNova",
        last: "System",
        locked: true,
        fields: {
          "Access Level": "Owner Admin",
          "Internal Notes": "Full data access granted",
          "Registered Users": "148 (13 visible due to server issues)"
        }
      }
    ];

    let ownerUnlocked = localStorage.getItem('snovaOwner') === 'true';

    const $q = document.getElementById("q");
    const $results = document.getElementById("results");
    const $empty = document.getElementById("empty");
    const $countPill = document.getElementById("countPill");
    const $selectedPill = document.getElementById("selectedPill");
    const $profilePanel = document.getElementById("profilePanel");
    const $urlPill = document.getElementById("urlPill");

    const $overlay = document.getElementById("overlay");
    const $modalTitle = document.getElementById("modalTitle");
    const $phaseTitle = document.getElementById("phaseTitle");
    const $phaseSub = document.getElementById("phaseSub");
    const $logBox = document.getElementById("logBox");
    const $smallNote = document.getElementById("smallNote");
    const $closeModal = document.getElementById("closeModal");

    $countPill.textContent = `${PEOPLE.length} profiles loaded`;

    function norm(s){ return (s || "").trim().toLowerCase(); }

    function matches(person, query){
      const q = norm(query);
      if(!q) return true;
      const first = norm(person.first);
      const last  = norm(person.last);
      const full  = `${first} ${last}`.trim();
      const tokens = q.split(/\s+/).filter(Boolean);
      return tokens.every(t =>
        first.includes(t) || last.includes(t) || full.includes(t)
      );
    }

    function qs(){ return new URLSearchParams(location.search); }

    function getLookupParam(){
      const search = location.search.slice(1);
      if(!search) return null;
      const parts = search.split('-');
      if(parts.length < 2) return null;
      const id = parts.pop();
      const bi = parts.join('-');
      return { id, bi };
    }

    function setUrlPill(){
      $urlPill.textContent = `URL: ${location.pathname}${location.search || ""}`;
    }

    function updateUrlForPerson(person, browserInfo=""){
      const bi = browserInfo || buildBrowserInfoToken();
      const lookupStr = `${bi}-${person.id}`;
      history.pushState({}, "", `${location.pathname}?${lookupStr}`);
      setUrlPill();
    }

    function findById(id){
      return PEOPLE.find(p => p.id === id) || null;
    }

    function renderResults(){
      const query = $q.value;
      const filtered = PEOPLE.filter(p => matches(p, query));
      const lookup = getLookupParam();
      const selectedId = lookup ? lookup.id : null;

      $results.innerHTML = "";
      $empty.style.display = filtered.length ? "none" : "block";

      filtered.forEach(p => {
        const row = document.createElement("div");
        row.className = "row" + (p.id === selectedId ? " active" : "");
        row.innerHTML = `
          <div class="nameLine">
            <div class="nm">${p.first} ${p.last}</div>
            <div class="sub">ID: ${p.id}</div>
          </div>
          <span class="tag ${p.locked ? "locked" : ""}">${p.locked ? "Locked" : "Available"}</span>
        `;
        row.addEventListener("click", () => {
          updateUrlForPerson(p);
          runLookup(p);
          renderResults();
        });
        $results.appendChild(row);
      });
    }

    function buildBrowserInfoToken(){
      const ua = navigator.userAgent.slice(0, 24).replace(/\s+/g,"_");
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "tz";
      const lang = navigator.language || "lang";
      return `${ua}-${lang}-${tz}`;
    }

    function computeLookupDuration(person){
      const fieldCount = person.fields ? Object.keys(person.fields).length : 0;
      const base = 900;
      const perField = 260;
      const jitter = Math.floor(Math.random()*250);
      const total = base + fieldCount*perField + jitter;
      return Math.max(800, Math.min(total, 3200));
    }

    function openModal(){ $overlay.classList.add("show"); }
    function closeModal(){ $overlay.classList.remove("show"); }

    $closeModal.addEventListener("click", closeModal);
    $overlay.addEventListener("click", (e) => { if(e.target === $overlay) closeModal(); });

    function setPanelLocked(person){
      $selectedPill.textContent = `${person.first} ${person.last}`;
      $profilePanel.innerHTML = `
        <div class="kv">
          <div class="item warn">
            <div class="k">Access</div>
            <div class="v">Protected by ScriptNova Owner</div>
            <div style="margin-top:6px;color:var(--muted);font-size:12px;line-height:1.55">
              This profile is locked due to owner rights.
            </div>
            <button class="unlock-btn" onclick="attemptOwnerUnlock('${person.id}')">Unlock as Owner</button>
          </div>
        </div>
      `;
    }

    function setPanelProfile(person){
      $selectedPill.textContent = `${person.first} ${person.last}`;
      const items = Object.entries(person.fields || {}).map(([k,v]) => `
        <div class="item">
          <div class="k">${k}</div>
          <div class="v">${String(v)}</div>
        </div>
      `).join("");

      $profilePanel.innerHTML = `
        <div class="kv">
          ${items || `<div class="item"><div class="k">No fields</div><div class="v">No data available</div></div>`}
        </div>
      `;
    }

    async function runLookup(person){
      openModal();
      $modalTitle.textContent = `Looking up: ${person.first} ${person.last}`;
      $phaseTitle.textContent = "Initializing lookup";
      $phaseSub.textContent = "Preparing logs…";
      $logBox.textContent = "[system] starting…";
      $smallNote.textContent = "";

      const total = computeLookupDuration(person);

      const steps = [
        { t: "Logs", s: "Collecting session logs…", line: "[log] checking logs…" },
        { t: "Checking data", s: "Validating available fields…", line: "[db] checking allowed fields…" },
        { t: "Verifying consent", s: "Confirming opt-in status…", line: "[consent] opt-in verified…" },
        { t: "Compiling report", s: "Formatting results…", line: "[report] compiling view…" }
      ];

      const stepTime = Math.floor(total / steps.length);

      for (let i=0; i<steps.length; i++){
        const st = steps[i];
        $phaseTitle.textContent = st.t;
        $phaseSub.textContent = st.s;
        $logBox.textContent += `\n${st.line}`;
        await new Promise(r => setTimeout(r, stepTime));
      }

      // Check if unlocked or not locked
      const isUnlocked = !person.locked || ownerUnlocked;
      if(!isUnlocked){
        $logBox.textContent += "\n[access] denied: protected profile";
        $smallNote.textContent = "Lookup finished. Owner unlock required.";
        setPanelLocked(person);
      }else{
        $logBox.textContent += "\n[done] lookup complete";
        $smallNote.textContent = `Loaded ${Object.keys(person.fields||{}).length} fields in ${total}ms (simulated).`;
        setPanelProfile(person);
      }

      setTimeout(() => closeModal(), 450);
    }

    // Owner unlock function (password hidden via SHA-256 hash)
    window.attemptOwnerUnlock = async function(currentId = null) {
      const pw = prompt("Enter ScriptNova Owner Key:");
      if(!pw) return;

      const encoder = new TextEncoder();
      const data = encoder.encode(pw);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

      if(hashHex === 'cc0bf93374660a1ca410ed095196833c1c39212d24d83568d7c2dc47845320b7'){
        ownerUnlocked = true;
        localStorage.setItem('snovaOwner', 'true');
        alert("Owner access granted. All locked profiles unlocked for this session.");
        
        // Re-run current lookup if we have an ID
        if(currentId){
          const person = findById(currentId);
          if(person) runLookup(person);
        } else {
          renderResults();
        }
      } else {
        alert("Invalid key.");
      }
    }

    document.getElementById("clearBtn").addEventListener("click", () => {
      $q.value = "";
      renderResults();
      $q.focus();
    });

    $q.addEventListener("input", renderResults);

    // Auto-run lookup if URL has the lookup param
    window.addEventListener("load", () => {
      setUrlPill();
      renderResults();

      const lookup = getLookupParam();
      if(lookup){
        const person = findById(lookup.id);
        if(person){
          $selectedPill.textContent = `${person.first} ${person.last}`;
          runLookup(person);
        } else {
          $selectedPill.textContent = "Unknown user";
          $profilePanel.innerHTML = `<div class="placeholder">No profile found for ID: ${lookup.id}</div>`;
        }
      }
    });

    // Handle back/forward
    window.addEventListener("popstate", () => {
      setUrlPill();
      renderResults();
      const lookup = getLookupParam();
      const person = lookup ? findById(lookup.id) : null;
      if(person) {
        $selectedPill.textContent = `${person.first} ${person.last}`;
      } else {
        $selectedPill.textContent = "None selected";
        $profilePanel.innerHTML = `<div class="placeholder">Select a person on the left to view details here.</div>`;
      }
    });

    // Dismiss disclaimer
    window.dismissDisclaimer = function(){
      document.getElementById("disclaimer").style.display = "none";
    };
  </script>
</body>
</html>